{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block content %}

<!-- [ Hero Section ] start -->
<section class="common-section">
  <div class="container animation-ref">
    <div class="pb-5 sm:pb-8 lg:pb-10">
      <div class="flex flex-col items-center gap-3">
        <!-- Badge -->
        <div class="animate-y delay-reset py-3 px-6 text-theme-textsecondary caption rounded-full border border-theme-divider">
          <p class="body1">✦&nbsp;&nbsp; {% trans "Tashxis Tayyor" %} &nbsp;&nbsp;✦</p>
        </div>

        <!-- Title -->
        <h1 class="animate-y max-w-[800px] text-center">
          {% trans "Tibbiy Xulosa" %}
        </h1>

        <!-- Subtitle -->
        <p class="animate-y h5 text-theme-text-secondary max-w-[620px] text-center">
          {% trans "Sun'iy intellekt yordamida tayyorlangan batafsil tahlil natijasi" %}
        </p>

        <!-- UUID Badge -->
        {% if uuid %}
        <div class="animate-y flex items-center gap-2 px-4 py-2 bg-neutral-100 rounded-lg border border-neutral-200 mt-3">
          <i class="ti ti-fingerprint text-primary-500"></i>
          <div class="text-left">
            <p class="caption text-neutral-600">{% trans "Tashxis ID" %}</p>
            <p class="body2 font-mono font-semibold">{{ uuid|slice:":8" }}...{{ uuid|slice:"-4:" }}</p>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
<!-- [ Hero Section ] end -->

<!-- [ Main Diagnosis Card ] start -->
<section class="common-section">
  <div class="container">
    <div class="animate-y delay-reset rounded-3xl sm:rounded-[32px] md:rounded-[40px] overflow-hidden
      {% if diagnosis_class == 'success' %}bg-green-50 border border-green-200
      {% elif diagnosis_class == 'warning' %}bg-yellow-50 border border-yellow-200
      {% else %}bg-red-50 border border-red-200{% endif %}">

      <div class="p-8 sm:p-10 md:p-12">
        <!-- Confidence Badge -->
        <div class="flex justify-center mb-8">
          <div class="inline-flex items-center gap-3 px-8 py-4 rounded-full
            {% if diagnosis_class == 'success' %}bg-green-500
            {% elif diagnosis_class == 'warning' %}bg-yellow-500
            {% else %}bg-red-500{% endif %} text-white">
            <i class="ti ti-award text-2xl"></i>
            <div>
              <p class="caption opacity-90">{% trans "Ishonch darajasi" %}</p>
              <p class="h5 font-bold">{{ confidence }}%</p>
            </div>
          </div>
        </div>

        <!-- Main Diagnosis -->
        <div class="text-center space-y-4">
          <div class="flex justify-center mb-4">
            <div class="w-20 h-20 rounded-full flex items-center justify-center
              {% if diagnosis_class == 'success' %}bg-green-500
              {% elif diagnosis_class == 'warning' %}bg-yellow-500
              {% else %}bg-red-500{% endif %}">
              <i class="ti {% if diagnosis_class == 'success' %}ti-circle-check{% elif diagnosis_class == 'warning' %}ti-alert-triangle{% else %}ti-alert-circle{% endif %} text-4xl text-white"></i>
            </div>
          </div>

          <h2 class="{% if diagnosis_class == 'success' %}text-green-700{% elif diagnosis_class == 'warning' %}text-yellow-700{% else %}text-red-700{% endif %}">
            {{ diagnosis }}
          </h2>

          <p class="h6 {% if diagnosis_class == 'success' %}text-green-600{% elif diagnosis_class == 'warning' %}text-yellow-600{% else %}text-red-600{% endif %} max-w-2xl mx-auto">
            {{ diagnosis_detail }}
          </p>
        </div>

        <!-- Risk Level -->
        <div class="flex justify-center mt-8">
          <div class="inline-flex items-center gap-2 py-2 px-6 rounded-full border
            {% if diagnosis_class == 'success' %}bg-white border-green-300
            {% elif diagnosis_class == 'warning' %}bg-white border-yellow-300
            {% else %}bg-white border-red-300{% endif %}">
            <div class="flex items-center gap-1">
              <div class="w-2 h-2 rounded-full animate-pulse {% if diagnosis_class == 'success' %}bg-green-500{% elif diagnosis_class == 'warning' %}bg-yellow-500{% else %}bg-red-500{% endif %}"></div>
              <div class="w-2 h-2 rounded-full animate-pulse {% if diagnosis_class == 'success' %}bg-green-500{% elif diagnosis_class == 'warning' %}bg-yellow-500{% else %}bg-red-500{% endif %}" style="animation-delay: 0.2s;"></div>
              <div class="w-2 h-2 rounded-full animate-pulse {% if diagnosis_class == 'success' %}bg-green-500{% elif diagnosis_class == 'warning' %}bg-yellow-500{% else %}bg-red-500{% endif %}" style="animation-delay: 0.4s;"></div>
            </div>
            <span class="subtitle1">{% trans "Xavf" %}: {{ risk_level }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- [ Main Diagnosis Card ] end -->

<!-- [ Patient Data Section ] start -->
<section class="common-section">
  <div class="container">
    <!-- Header -->
    <div class="text-center mb-8 sm:mb-10">
      <div class="animate-y inline-flex items-center gap-2 px-4 py-2 bg-primary-50 rounded-full mb-4">
        <i class="ti ti-user-scan text-primary-500"></i>
        <span class="caption text-primary-600">{% trans "Bemor Ma'lumotlari" %}</span>
      </div>
      <h2 class="animate-y">{% trans "Tibbiy Ko'rsatkichlar" %}</h2>
      <p class="animate-y h6 text-theme-text-secondary max-w-2xl mx-auto mt-3">
        {% trans "Tahlil uchun kiritilgan barcha laboratoriya va klinik ma'lumotlar" %}
      </p>
    </div>

    <!-- Stats Cards Grid -->
    <div class="animate-y delay-reset rounded-3xl sm:rounded-[32px] md:rounded-[40px] bg-neutral-100 overflow-hidden">
      <div class="p-6 sm:p-8 md:p-10">
        <div class="flex flex-col">
          <!-- Yoshi -->
          <div class="flex flex-row items-center py-3 sm:py-5 gap-2 lg:gap-3 border-b border-neutral-200">
            <div class="flex items-center gap-3 w-full">
              <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center shrink-0">
                <i class="ti ti-user text-blue-600"></i>
              </div>
              <div class="flex flex-col gap-1 grow">
                <h5 class="text-theme-text-secondary">{% trans "Yoshi" %}</h5>
                <div class="w-full bg-neutral-300 rounded-lg h-[6px]">
                  <div class="bg-primary-500 h-full rounded-lg" style="width: {{ patient_data.age }}%"></div>
                </div>
              </div>
            </div>
            <div class="flex flex-row items-end">
              <div class="h2">{{ patient_data.age }}</div>
              <div class="h4 text-theme-text-secondary mb-1">{% trans "yosh" %}</div>
            </div>
          </div>

          <!-- Jinsi -->
          <div class="flex flex-row items-center py-3 sm:py-5 gap-2 lg:gap-3 border-b border-neutral-200">
            <div class="flex items-center gap-3 w-full">
              <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center shrink-0">
                <i class="ti ti-gender-bigender text-purple-600"></i>
              </div>
              <div class="flex flex-col gap-1 grow">
                <h5 class="text-theme-text-secondary">{% trans "Jinsi" %}</h5>
              </div>
            </div>
            <div class="h3">{{ patient_data.gender }}</div>
          </div>

          <!-- TSH -->
          <div class="flex flex-row items-center py-3 sm:py-5 gap-2 lg:gap-3 border-b border-neutral-200">
            <div class="flex items-center gap-3 w-full">
              <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center shrink-0">
                <i class="ti ti-flask text-green-600"></i>
              </div>
              <div class="flex flex-col gap-1 grow">
                <h5 class="text-theme-text-secondary">{% trans "TSH Darajasi" %} (0.4-4.0 mIU/L)</h5>
                <div class="w-full bg-neutral-300 rounded-lg h-[6px]">
                  <div class="bg-primary-500 h-full rounded-lg" style="width: {% widthratio patient_data.tsh 4 100 %}%"></div>
                </div>
              </div>
            </div>
            <div class="flex flex-row items-end">
              <div class="h2">{{ patient_data.tsh }}</div>
              <div class="h4 text-theme-text-secondary mb-1">mIU/L</div>
            </div>
          </div>

          <!-- T3 -->
          <div class="flex flex-row items-center py-3 sm:py-5 gap-2 lg:gap-3 border-b border-neutral-200">
            <div class="flex items-center gap-3 w-full">
              <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center shrink-0">
                <i class="ti ti-test-pipe text-yellow-600"></i>
              </div>
              <div class="flex flex-col gap-1 grow">
                <h5 class="text-theme-text-secondary">{% trans "T3 Darajasi" %} (80-200 ng/dL)</h5>
                <div class="w-full bg-neutral-300 rounded-lg h-[6px]">
                  <div class="bg-primary-500 h-full rounded-lg" style="width: {% widthratio patient_data.t3 200 100 %}%"></div>
                </div>
              </div>
            </div>
            <div class="flex flex-row items-end">
              <div class="h2">{{ patient_data.t3 }}</div>
              <div class="h4 text-theme-text-secondary mb-1">ng/dL</div>
            </div>
          </div>

          <!-- T4 -->
          <div class="flex flex-row items-center py-3 sm:py-5 gap-2 lg:gap-3 border-b border-neutral-200">
            <div class="flex items-center gap-3 w-full">
              <div class="w-10 h-10 bg-cyan-100 rounded-lg flex items-center justify-center shrink-0">
                <i class="ti ti-droplet text-cyan-600"></i>
              </div>
              <div class="flex flex-col gap-1 grow">
                <h5 class="text-theme-text-secondary">{% trans "T4 Darajasi" %} (5.0-12.0 μg/dL)</h5>
                <div class="w-full bg-neutral-300 rounded-lg h-[6px]">
                  <div class="bg-primary-500 h-full rounded-lg" style="width: {% widthratio patient_data.t4 12 100 %}%"></div>
                </div>
              </div>
            </div>
            <div class="flex flex-row items-end">
              <div class="h2">{{ patient_data.t4 }}</div>
              <div class="h4 text-theme-text-secondary mb-1">μg/dL</div>
            </div>
          </div>

          <!-- Tugun -->
          <div class="flex flex-row items-center py-3 sm:py-5 gap-2 lg:gap-3">
            <div class="flex items-center gap-3 w-full">
              <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center shrink-0">
                <i class="ti ti-circle-dot text-red-600"></i>
              </div>
              <div class="flex flex-col gap-1 grow">
                <h5 class="text-theme-text-secondary">{% trans "Tugun O'lchami" %}</h5>
                <div class="w-full bg-neutral-300 rounded-lg h-[6px]">
                  <div class="bg-primary-500 h-full rounded-lg" style="width: {% widthratio patient_data.nodule_size 3 100 %}%"></div>
                </div>
              </div>
            </div>
            <div class="flex flex-row items-end">
              <div class="h2">{{ patient_data.nodule_size }}</div>
              <div class="h4 text-theme-text-secondary mb-1">{% trans "sm" %}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- [ Patient Data Section ] end -->

<!-- [ Recommendations Section ] start -->
<section class="common-section">
  <div class="container">
    <!-- Header -->
    <div class="text-center mb-8 sm:mb-10">
      <div class="animate-y inline-flex items-center gap-2 px-4 py-2 bg-primary-50 rounded-full mb-4">
        <i class="ti ti-stethoscope text-primary-500"></i>
        <span class="caption text-primary-600">{% trans "Tibbiy Tavsiyalar" %}</span>
      </div>
      <h2 class="animate-y">{% trans "Mutaxassis Maslahatlari" %}</h2>
      <p class="animate-y h6 text-theme-text-secondary max-w-2xl mx-auto mt-3">
        {% trans "Profesional shifokorlar tomonidan tavsiya etilgan harakatlar rejasi" %}
      </p>
    </div>

    <!-- Recommendations List -->
    <div class="space-y-3">
      {% for rec in recommendations %}
      <div class="animate-y delay-reset rounded-3xl sm:rounded-[32px] md:rounded-[40px] bg-neutral-100 overflow-hidden hover:bg-neutral-200 transition-all">
        <div class="p-6 md:p-8">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-primary-500 rounded-full flex items-center justify-center shrink-0">
              <span class="subtitle1 text-white">{{ forloop.counter }}</span>
            </div>
            <p class="body1 text-theme-text-primary flex-1">{{ rec }}</p>
            <div class="w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center shrink-0">
              <i class="ti ti-chevron-right text-primary-500"></i>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>
<!-- [ Recommendations Section ] end -->

<!-- [ Warning Section ] start -->
<section class="common-section">
  <div class="container">
    <div class="animate-y delay-reset rounded-3xl sm:rounded-[32px] md:rounded-[40px] bg-yellow-50 border-2 border-yellow-200 overflow-hidden">
      <div class="p-8 sm:p-10 md:p-12">
        <div class="flex flex-col lg:flex-row items-start gap-6">
          <div class="w-16 h-16 lg:w-20 lg:h-20 bg-yellow-400 rounded-2xl flex items-center justify-center shrink-0">
            <i class="ti ti-alert-triangle text-3xl lg:text-4xl text-white"></i>
          </div>

          <div class="flex-1 space-y-6">
            <div>
              <h3 class="text-yellow-900 mb-3">{% trans "Muhim Tibbiy Ogohlantirish" %}</h3>
              <p class="body1 text-yellow-800">
                {% trans "Bu natija faqat sun'iy intellekt yordamida berilgan dastlabki tashxis hisoblanadi. Aniq tashxis va to'g'ri davolanish uchun malakali shifokor bilan shaxsiy maslahatlashish majburiy!" %}
              </p>
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div class="rounded-2xl bg-white p-5 border border-yellow-200">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 bg-yellow-100 rounded-xl flex items-center justify-center shrink-0">
                    <i class="ti ti-user-check text-yellow-600"></i>
                  </div>
                  <div>
                    <p class="subtitle1 mb-1">{% trans "Professional Ko'rik" %}</p>
                    <p class="caption text-neutral-600">{% trans "Endokrinolog yoki onkolog bilan uchrashing" %}</p>
                  </div>
                </div>
              </div>

              <div class="rounded-2xl bg-white p-5 border border-yellow-200">
                <div class="flex items-start gap-3">
                  <div class="w-10 h-10 bg-yellow-100 rounded-xl flex items-center justify-center shrink-0">
                    <i class="ti ti-test-pipe text-yellow-600"></i>
                  </div>
                  <div>
                    <p class="subtitle1 mb-1">{% trans "Qo'shimcha Tahlillar" %}</p>
                    <p class="caption text-neutral-600">{% trans "Laboratoriya va instrumental tekshiruvlar" %}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- [ Warning Section ] end -->

<!-- [ Action Section ] start -->
<section class="common-section">
  <div class="container">
    <div class="animate-y delay-reset rounded-3xl sm:rounded-[32px] md:rounded-[40px] bg-neutral-200 overflow-hidden">
      <div class="p-8 sm:p-10 md:p-12">
        <!-- Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
          <a href="{% url 'home' %}" class="btn btn-primary btn-lg">
            <i class="ti ti-home"></i>
            <span>{% trans "Bosh sahifa" %}</span>
          </a>

          {% if uuid %}
          <a href="{% url 'download_diagnosis' uuid=uuid %}" class="btn btn-outline-primary btn-lg">
            <i class="ti ti-download"></i>
            <span>{% trans "Xulosani Yuklab Olish" %}</span>
          </a>
          {% endif %}

          <a href="/#diagnos" class="btn btn-outline-primary btn-lg">
            <i class="ti ti-reload"></i>
            <span>{% trans "Yangi Tashxis" %}</span>
          </a>
        </div>

        <!-- Footer Info -->
        <div class="pt-6 border-t border-neutral-300">
          <div class="flex flex-col sm:flex-row items-center justify-between gap-4 text-center sm:text-left">
            <div class="flex items-center gap-2">
              <i class="ti ti-calendar text-primary-500"></i>
              <p class="caption text-theme-text-secondary">
                {% trans "Tahlil sanasi" %}: <span class="font-medium">{% if created_at %}{{ created_at|date:"d.m.Y H:i" }}{% else %}{{ "now"|date:"d.m.Y H:i" }}{% endif %}</span>
              </p>
            </div>
            <div class="flex items-center gap-2">
              <i class="ti ti-shield-check text-primary-500"></i>
              <p class="caption text-theme-text-secondary">
                AI Model: <span class="font-medium">Thyroid Diagnostics v2.0</span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- [ Action Section ] end -->

{% endblock %}