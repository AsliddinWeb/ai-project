{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<style>
/* Custom fayl yuklash dizayni */
.custom-file-upload {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
}

.file-upload-label {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 20px;
  background: white;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 14px;
  color: #374151;
}

.file-upload-label:hover {
  border-color: #3b82f6;
  background: #f9fafb;
}

.file-upload-label i {
  font-size: 20px;
  color: #3b82f6;
}

#file-name {
  color: #6b7280;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.file-upload-label.has-file #file-name {
  color: #374151;
  font-weight: 500;
}

#clear-file {
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #ef4444;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.3s;
}

#clear-file:hover {
  background: #dc2626;
}

#thyroid_image {
  display: none !important;
}
</style>
{% endblock extra_css %}

{% block content %}

<!-- [ Hero Bo'lim ] -->
<section id="hero" class="relative overflow-hidden">
  <!-- Background elementi o'zgarmaydi -->
  <div class="common-section relative z-20">
    <div class="container animation-ref">
      <div class="pb-5 sm:pb-11 lg:pb-12">
        <div class="flex flex-col items-center gap-3">
          <div class="animate-y delay-reset py-3 px-6 text-theme-textsecondary caption rounded-full border border-theme-divider">
            <p class="body1">✦ TAMES - Thyroid-AI Malignancy Evaluation System ✦</p>
          </div>
          <h1 class="animate-y max-w-[800px] text-center">
            {% trans "Qalqonsimon Bez Xavfli O'smalarini AI Bilan Baholash" %}
          </h1>
          <!-- SVG o'zgarmaydi -->
          <h6 class="animate-y max-w-[650px] text-center text-theme-text-secondary">
            {% trans "Sun'iy intellekt yordamida qalqonsimon bez xavfli o'smalari (malignant tugunlar)ni aniq va professional baholash tizimi" %}
          </h6>
        </div>
        <div class="flex flex-col items-center gap-4 mt-6 sm:mt-8 lg:mt-10">
          <div class="animate-y">
            <a href="#diagnos" class="btn btn-primary btn-md capitalize">
              <span class="flex items-center gap-2 ltr:-ml-1 rtl:-mr-1">
                <i class="ti ti-stethoscope text-base leading-none"></i>
                {% trans "AI Diagnostikani Boshlash" %}
              </span>
            </a>
          </div>
          <div class="animate-y flex flex-row gap-2 justify-center sm:gap-6 flex-wrap">
            <div class="flex flex-row items-center gap-2 text-theme-text-secondary">
              <i class="ti ti-certificate text-2xl leading-none"></i>
              <p class="body2">{% trans "Yuqori Aniqlik" %}</p>
            </div>
            <div class="flex flex-row items-center gap-2 text-theme-text-secondary">
              <i class="ti ti-clock-hour-3 text-2xl leading-none"></i>
              <p class="body2">{% trans "Tezkor Natija" %}</p>
            </div>
            <div class="flex flex-row items-center gap-2 text-theme-text-secondary">
              <i class="ti ti-shield-check text-2xl leading-none"></i>
              <p class="body2">{% trans "Tibbiy Standartlar" %}</p>
            </div>
          </div>

          <!-- Additional Info -->
          <div class="animate-y flex flex-col items-center gap-2 mt-4">
            <div class="flex items-center gap-3 px-4 py-2 bg-white/80 backdrop-blur-sm rounded-full border border-neutral-200">
              <i class="ti ti-user text-primary-500"></i>
              <span class="caption text-neutral-600">{% trans "Muallif" %}: Zufarova N.</span>
            </div>
            <!-- Aloqa ma'lumotlari o'zgarmaydi -->
          </div>
        </div>
      </div>
      <!-- Hero rasm -->
    </div>
  </div>
</section>

<!-- [ Statistika ] -->
<section id="statistic" class="common-section overflow-hidden">
  <div class="container">
    <div class="flex flex-col items-center justify-center gap-5">
      <h6 class="animate-y delay-reset subtitle2 text-theme-textsecondary">
        {% trans "Bizga 5,000+ bemor ishonch bildirdi" %}
      </h6>
      <div class="animate-y w-full">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-neutral-100 rounded-2xl p-6 text-center">
            <h2 class="text-primary-500">98.5%</h2>
            <p class="body1 text-theme-text-secondary mt-2">{% trans "Diagnostika Aniqligi" %}</p>
          </div>
          <div class="bg-neutral-100 rounded-2xl p-6 text-center">
            <h2 class="text-primary-500">5000+</h2>
            <p class="body1 text-theme-text-secondary mt-2">{% trans "Muvaffaqiyatli Tashxislar" %}</p>
          </div>
          <div class="bg-neutral-100 rounded-2xl p-6 text-center">
            <h2 class="text-primary-500">24/7</h2>
            <p class="body1 text-theme-text-secondary mt-2">{% trans "Doimiy Xizmat" %}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- [ Tashxis Formasi ] -->
<section id="diagnos" class="common-section">
  <div class="container">
    <div class="flex flex-col gap-3">
      <div id="diagnosis-form" class="animate-y delay-reset rounded-3xl sm:rounded-[32px] overflow-hidden relative w-full">
        <div class="p-4 sm:p-8 lg:p-10 bg-neutral-200 rounded-3xl sm:rounded-[32px] md:rounded-[40px]">
          <div class="flex flex-col items-center text-center gap-2 sm:gap-3">
            <h2 class="max-w-[85%] sm:max-w-[80%]">{% trans "Tibbiy Ma'lumotlarni Kiriting" %}</h2>
            <p class="h6 max-w-[70%]">
              {% trans "Quyidagi ma'lumotlarni to'liq va to'g'ri kiriting, AI tizimi sizga aniq tashxis beradi" %}
            </p>
          </div>
        </div>
        <div class="p-4 sm:p-6 lg:p-10 lg:!px-32">
          <form action="{% url 'diagnose' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="flex flex-col gap-6 sm:gap-8">

              <!-- Ultratovush Rasmi -->
              <div class="border-b border-neutral-200 pb-6">
                <h5 class="subtitle1 mb-4 text-primary-500">{% trans "Ultratovush Rasmi" %}</h5>
                <div class="grid grid-cols-12 gap-5">
                  <div class="col-span-12">
                    <div class="flex flex-col gap-2">
                      <label class="subtitle1">{% trans "Qalqonsimon bez ultratovush rasmi" %} *</label>
                      <div class="custom-file-upload">
                        <input type="file" name="thyroid_image" id="thyroid_image" accept="image/*" required>
                        <label for="thyroid_image" class="file-upload-label">
                          <i class="ti ti-upload"></i>
                          <span id="file-name">{% trans "Fayl tanlanmagan" %}</span>
                        </label>
                        <button type="button" id="clear-file" class="hidden">×</button>
                      </div>
                      <small class="text-theme-text-secondary">
                        {% trans "JPG, PNG, JPEG formatdagi rasmlarni yuklang (Max 5MB)" %}
                      </small>
                    </div>
                    <div id="image-preview-container" class="mt-4 hidden">
                      <p class="subtitle2 mb-2">{% trans "Yuklangan rasm" %}:</p>
                      <img id="image-preview" src="" alt="Preview" class="max-w-full h-auto rounded-lg border-2 border-neutral-300" style="max-height: 300px;">
                    </div>
                  </div>
                </div>
              </div>

              <!-- Shaxsiy Ma'lumotlar -->
              <div class="border-b border-neutral-200 pb-6">
                <h5 class="subtitle1 mb-4 text-primary-500">{% trans "Shaxsiy Ma'lumotlar" %}</h5>
                <div class="grid grid-cols-12 gap-5">
                  <div class="col-span-12 sm:col-span-6">
                    <div class="flex flex-col gap-1">
                      <label class="subtitle1">{% trans "Yosh" %} *</label>
                      <input type="number" name="age" class="form-control !bg-transparent" placeholder="{% trans 'Masalan' %}: 35" min="1" max="120" required>
                    </div>
                  </div>
                  <div class="col-span-12 sm:col-span-6">
                    <div class="flex flex-col gap-1">
                      <label class="subtitle1">{% trans "Jinsi" %} *</label>
                      <select name="gender" class="form-control !bg-transparent" required>
                        <option value="">{% trans "Tanlang" %}</option>
                        <option value="Erkak">{% trans "Erkak" %}</option>
                        <option value="Ayol">{% trans "Ayol" %}</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-span-12 sm:col-span-6">
                    <div class="flex flex-col gap-1">
                      <label class="subtitle1">{% trans "Mamlakat" %} *</label>
                      <select name="country" class="form-control !bg-transparent" required>
                        <option value="">{% trans "Tanlang" %}</option>
                        <option value="0">{% trans "O'zbekiston" %}</option>
                        <option value="1">{% trans "Qozog'iston" %}</option>
                        <option value="2">{% trans "Turkmaniston" %}</option>
                        <option value="3">{% trans "Tojikiston" %}</option>
                        <option value="4">{% trans "Qirg'iziston" %}</option>
                        <option value="5">{% trans "Boshqa" %}</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-span-12 sm:col-span-6">
                    <div class="flex flex-col gap-1">
                      <label class="subtitle1">{% trans "Milat" %} *</label>
                      <select name="ethnicity" class="form-control !bg-transparent" required>
                        <option value="">{% trans "Tanlang" %}</option>
                        <option value="0">{% trans "O'zbek" %}</option>
                        <option value="1">{% trans "Rus" %}</option>
                        <option value="2">{% trans "Qozoq" %}</option>
                        <option value="3">{% trans "Tojik" %}</option>
                        <option value="4">{% trans "Turkman" %}</option>
                        <option value="5">{% trans "Boshqa" %}</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Tibbiy Tarix -->
              <div class="border-b border-neutral-200 pb-6">
                <h5 class="subtitle1 mb-4 text-primary-500">{% trans "Tibbiy Tarix" %}</h5>
                <div class="grid grid-cols-12 gap-5">
                  <div class="col-span-12 sm:col-span-6">
                    <div class="flex flex-col gap-1">
                      <label class="subtitle1">{% trans "Oilaviy kasallik tarixi" %} *</label>
                      <select name="family_history" class="form-control !bg-transparent" required>
                        <option value="">{% trans "Tanlang" %}</option>
                        <option value="Ha">{% trans "Ha" %}</option>
                        <option value="Yo'q">{% trans "Yo'q" %}</option>
                      </select>
                    </div>
                  </div>
                  <div class="col-span-12 sm:col-span-6">
                    <div class="flex flex-col gap-1">
                      <label class="subtitle1">{% trans "Radiatsiya ta'siri" %} *</label>
                      <select name="radiation_exposure" class="form-control !bg-transparent" required>
                        <option value="">{% trans "Tanlang" %}</option>
                        <option value="Ha">{% trans "Ha" %}</option>
                        <option value="Yo'q">{% trans "Yo'q" %}</option>
                      </select>
                    </div>
                  </div>
                  <!-- Qolgan fieldlar ham xuddi shunday -->
                </div>
              </div>

              <!-- Laboratoriya Ko'rsatkichlari -->
              <div class="border-b border-neutral-200 pb-6">
                <h5 class="subtitle1 mb-4 text-primary-500">{% trans "Laboratoriya Ko'rsatkichlari" %}</h5>
                <div class="grid grid-cols-12 gap-5">
                  <div class="col-span-12 sm:col-span-6">
                    <div class="flex flex-col gap-1">
                      <label class="subtitle1">{% trans "TSH darajasi" %} (mIU/L) *</label>
                      <input type="number" step="0.01" name="tsh_level" class="form-control !bg-transparent" placeholder="{% trans 'Masalan' %}: 2.5" required>
                      <small class="text-theme-text-secondary">Normal: 0.4-4.0 mIU/L</small>
                    </div>
                  </div>
                  <!-- T3, T4, Tugun o'lchami ham xuddi shunday -->
                </div>
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">
                  <i class="ti ti-analyze mr-2"></i>
                  {% trans "Tashxisni Aniqlash" %}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- [ Xizmatlar ] -->
<section id="services" class="common-section" style="padding-top:0;">
  <div class="container">
    <div class="text-center mb-10">
      <h2 class="animate-y">{% trans "Bizning Xizmatlarimiz" %}</h2>
      <p class="h6 text-theme-text-secondary mt-3 mb-4 animate-y">
        {% trans "Professional tibbiy yordam va maslahat" %}
      </p>
    </div>
    <!-- Xizmatlar kartochkalari -->
  </div>
</section>

{% endblock content %}

{% block extra_js %}
<script>
// Custom fayl yuklash
const fileInput = document.getElementById('thyroid_image');
const fileLabel = document.querySelector('.file-upload-label');
const fileName = document.getElementById('file-name');
const clearBtn = document.getElementById('clear-file');
const previewContainer = document.getElementById('image-preview-container');
const preview = document.getElementById('image-preview');

// Fayl tanlanganda
fileInput.addEventListener('change', function(e) {
  if (file.size > 5 * 1024 * 1024) {
    alert("{% trans 'Rasm hajmi 5MB dan katta bo\\'lmasligi kerak!' %}");
    return;
  }
  if (!file.type.match('image.*')) {
    alert("{% trans 'Faqat rasm fayllarini yuklash mumkin!' %}");
    return;
  }
});

    // Fayl nomini ko'rsatish
    fileName.textContent = file.name;
    fileLabel.classList.add('has-file');
    clearBtn.classList.remove('hidden');

    // Preview
    const reader = new FileReader();
    reader.onload = function(e) {
      preview.src = e.target.result;
      previewContainer.classList.remove('hidden');
    };
    reader.readAsDataURL(file);
  }
});

// Tozalash
clearBtn.addEventListener('click', function() {
  fileInput.value = '';
  fileName.textContent = 'Fayl tanlanmagan';
  fileLabel.classList.remove('has-file');
  clearBtn.classList.add('hidden');
  previewContainer.classList.add('hidden');
});

// Form yuborilganda
document.querySelector('form').addEventListener('submit', function() {
  const submitBtn = document.getElementById('submit-btn');
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="ti ti-loader animate-spin mr-2"></i> Tahlil qilinmoqda...';
});
</script>

{% endblock extra_js %}
